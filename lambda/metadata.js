!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t){e.exports=require("core-js/modules/es.object.to-string")},function(e,t){e.exports=require("core-js/modules/es.regexp.to-string")},function(e,t){e.exports=require("core-js/modules/es.string.pad-start")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("web3")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("@pinata/sdk")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("form-data")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";n.r(t);n(0),n(1),n(2),n(7);function a(e,t,n,a,i,r,p){try{var u=e[r](p),o=u.value}catch(e){return void n(e)}u.done?t(o):Promise.resolve(o).then(a,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var p=e.apply(t,n);function u(e){a(p,i,r,u,o,"next",e)}function o(e){a(p,i,r,u,o,"throw",e)}u(void 0)}))}}function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=o(e);if(t){var i=o(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return y(this,n)}}var d=n(3),m=n.n(d),c=n(4),b=n.n(c),f=n(5),T=n.n(f),v=n(6),g=n.n(v);n(8),n(9),n(10),n(11);m.a.config();var _=process.env,M=_.PINATA_API_KEY,x=_.PINATA_API_SECRET,w=(_.WALLET_PRIVATE_KEY,_.EXTERNAL_URL_BASE),h=_.WEB3_PROVIDER_ENDPOINT,S=_.CONTRACT_ADDRESS,k=new b.a(h),R=new k.eth.Contract([{inputs:[{internalType:"address",name:"_link",type:"address"},{internalType:"address",name:"_feed",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"id",type:"bytes32"}],name:"ChainlinkCancelled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"id",type:"bytes32"}],name:"ChainlinkFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"id",type:"bytes32"}],name:"ChainlinkRequested",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_balance",type:"uint256"},{indexed:!1,internalType:"uint256",name:"_remaining",type:"uint256"}],name:"LowLINK",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"ANIMATION_COUNT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ANIMATOR_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"ARTIST_PRINTS",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ARTIST_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"BETA_SALE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"LINK_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"SCHEME_COUNT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"TOKEN_LIMIT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"TREASURER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"baseURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"_seed",type:"string"},{internalType:"uint8",name:"shapes",type:"uint8"},{internalType:"uint16[6]",name:"palette",type:"uint16[6]"},{internalType:"int16[13]",name:"dials",type:"int16[13]"}],name:"buy",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"payable",type:"function"},{inputs:[],name:"currentLinkPrice",outputs:[{internalType:"uint256",name:"price",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentPrice",outputs:[{internalType:"uint256",name:"price",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"uint256",name:"index",type:"uint256"}],name:"getRoleMember",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleMemberCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"linkPremium",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"}],name:"linkPriceAt",outputs:[{internalType:"uint256",name:"price",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"onTokenTransfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"}],name:"priceAt",outputs:[{internalType:"uint256",name:"price",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"priceIncrease",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"requestId",type:"bytes32"},{internalType:"uint256",name:"randomness",type:"uint256"}],name:"rawFulfillRandomness",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"_keyHash",type:"bytes32"},{internalType:"uint256",name:"_fee",type:"uint256"},{internalType:"uint256",name:"_seed",type:"uint256"}],name:"requestRandomness",outputs:[{internalType:"bytes32",name:"requestId",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"startPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"},{internalType:"bool",name:"animate",type:"bool"}],name:"tokenArt",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"}],name:"tokenData",outputs:[{internalType:"uint256",name:"randomness",type:"uint256"},{internalType:"uint8",name:"animation",type:"uint8"},{internalType:"uint8",name:"shapes",type:"uint8"},{internalType:"uint16",name:"hatching",type:"uint16"},{internalType:"uint16[6]",name:"palette",type:"uint16[6]"},{internalType:"uint16[4]",name:"size",type:"uint16[4]"},{internalType:"uint16[4]",name:"spacing",type:"uint16[4]"},{internalType:"int16[3]",name:"mirrorPositions",type:"int16[3]"},{internalType:"uint16",name:"scale",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"_seed",type:"string"},{internalType:"uint8",name:"shapes",type:"uint8"},{internalType:"uint16[6]",name:"palette",type:"uint16[6]"},{internalType:"int16[13]",name:"dials",type:"int16[13]"},{internalType:"uint8",name:"animation",type:"uint8"},{internalType:"bool",name:"animate",type:"bool"}],name:"tokenTest",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"},{internalType:"string",name:"_uri",type:"string"}],name:"updateURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawLINK",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}],S),A=function(e,t){return{statusCode:t,body:JSON.stringify(e)}};T.a;function I(e){return new Promise((function(t,n){k.eth.subscribe("logs",{address:S,fromBlock:0,topics:["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x0000000000000000000000000000000000000000000000000000000000000000",null,"0x"+e.toString(16).padStart(64,"0")]}).on("data",function(){var e=i(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("...Minted Block..."),k.eth.getBlock(a.blockNumber,(function(e,a){e?n(e):t(a)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}exports.handler=function(){var e=i(regeneratorRuntime.mark((function e(t,n){var a,i,r,p,u,o,s,y,l,d,m,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=parseInt(t.queryStringParameters.id,10),console.log(S),"GET"===t.httpMethod){e.next=8;break}return console.log("Bad method:",t.httpMethod),e.abrupt("return",A("Bad method:"+t.httpMethod,405));case 8:if(void 0!==a){e.next=11;break}return console.log("Undefined ID parameter is required"),e.abrupt("return",A("Undefined ID parameter is required",204));case 11:return console.log("Checking token of ID ",a," exists"),e.next=14,R.methods.ownerOf(a).call();case 14:if("0x0000000000000000000000000000000000000000"!==e.sent){e.next=18;break}return console.log("Token "+a+" dosn't exist"),e.abrupt("return",A("Token "+a+" dosn't exist",204));case 18:return console.log("Looking Up Token..."),console.log("...Data..."),i=R.methods.tokenData(a).call(),console.log("...Art..."),r=R.methods.tokenArt(a,!1).call(),console.log("...Animation..."),p=R.methods.tokenArt(a,!0).call(),console.log("...Mined Block Number..."),u=I(a),console.log("Awaiting requests..."),o="",s="",y="",l="",e.next=31,i.catch((function(e){return console.error(e)}));case 31:return o=e.sent,e.next=34,r.catch((function(e){return console.error(e)}));case 34:return s=e.sent,e.next=37,p.catch((function(e){return console.error(e)}));case 37:return y=e.sent,e.next=40,u.catch((function(e){return console.error(e)}));case 40:if(l=e.sent,void 0!==o&&void 0!==s&&void 0!==y){e.next=43;break}return e.abrupt("return",A("Server Error",500));case 43:return console.log("Lookup Complete!"),console.log("Connecting to Pinata SDK..."),g()(M,x),console.log("Building Metadata"),d=["Rounding Corners","Grow n Shrink","Squash n Stretch","Skew X","Skew Y","Snap Spin 1","Snap Spin 2","Snap Spin 3","Snap Spin 4","Spread","Spread Over Time","Glide","Uniform Speed Spin","2 Speed Spin","Indexed Spin","Jitter","Giggle","Jolt","Drop"],m=["Mono","Complimentary","Analogous","Series","Split Complimentary","Triadic","Complimentary and Analogous","Analogous and Complimentary","Square","Tetradic"],c={name:"TinyBox #"+a,description:"A scattering of tiny boxes, Aranged in patterns ranging from mundane to magnificent.",external_url:w+a,image_data:y,background_color:"121212",attributes:[{display_type:"number",trait_type:"Shapes",value:parseInt(o.shapes)},{display_type:"number",trait_type:"Color Scheme",value:m[o.palette[4]]},{display_type:"number",trait_type:"Root Hue",value:parseInt(o.palette[0])},{display_type:"number",trait_type:"Saturation",value:parseInt(o.palette[1])},{display_type:"number",trait_type:"Lightness",value:parseInt(o.palette[2])+""+parseInt(o.palette[3])},{display_type:"number",trait_type:"Shades",value:parseInt(o.palette[5])},{display_type:"number",trait_type:"Animation",value:d[o.animation]},{trait_type:"Hatching",value:o.hatching},{trait_type:"Mirror 1",value:o.mirrorPositions[0]},{trait_type:"Mirror 2",value:o.mirrorPositions[1]},{trait_type:"Mirror 3",value:o.mirrorPositions[2]},{trait_type:"Scale",value:o.scale+"%"},{display_type:"date",trait_type:"Created",value:l.timestamp},{display_type:"date",trait_type:"Rendered",value:Date.now()}]},console.log("Metadata of token "+a),console.log(c),e.abrupt("return",A(c,200));case 55:return e.prev=55,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",A("Server Error",500));case 59:case"end":return e.stop()}}),e,null,[[0,55]])})));return function(t,n){return e.apply(this,arguments)}}()}]));